<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Acropolis Realty - Marketplace</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
    <style>
        html, body { height: 100%; width: 100%; margin: 0; padding: 0; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        #mi-mapa { height: 100%; width: 100%; position: absolute; top: 0; left: 0; }
        
        /* Interfaz Superior con Logo a la Derecha */
        .header-ui { position: absolute; top: 10px; left: 10px; right: 10px; z-index: 1000; display: flex; flex-direction: column; gap: 8px; }
        .search-container { display: flex; align-items: center; background: white; border-radius: 30px; padding: 5px 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.15); }
        .search-bar { border: none; flex-grow: 1; outline: none; font-size: 15px; padding: 10px; width: 50%; }
        .logo-top-right { height: 45px; margin-left: 10px; }

        .filters { display: flex; gap: 6px; overflow-x: auto; scrollbar-width: none; padding: 2px; }
        .btn-f { background: white; border: none; padding: 8px 15px; border-radius: 20px; white-space: nowrap; font-size: 11px; font-weight: 600; box-shadow: 0 2px 8px rgba(0,0,0,0.1); cursor: pointer; }
        .active { background: #d32f2f !important; color: white !important; }

        /* FOTOS: Sin cortes (Contain) */
        .img-local-chica { width: 100%; height: auto; max-height: 120px; object-fit: contain; border-radius: 8px; background: #f9f9f9; }
        
        /* SLIDER BODEGA 66 */
        .slider-container { width: 100%; height: auto; overflow-x: scroll; display: flex; scroll-snap-type: x mandatory; border-radius: 8px; scrollbar-width: none; background: #eee; }
        .slider-container::-webkit-scrollbar { display: none; }
        .slider-container img { width: 100%; height: auto; max-height: 120px; object-fit: contain; flex-shrink: 0; scroll-snap-align: start; }

        /* GPS CIRCULAR */
        .gps-wrapper { position: absolute; bottom: 30px; right: 20px; z-index: 1000; width: 100px; height: 100px; display: flex; align-items: center; justify-content: center; }
        .gps-btn { width: 55px; height: 55px; background: #d32f2f; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.3); font-size: 24px; cursor: pointer; border: none; z-index: 10; }
        .circular-text { position: absolute; width: 100%; height: 100%; animation: rotateText 15s linear infinite; }
        @keyframes rotateText { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .circular-text text { font-size: 11px; font-weight: bold; fill: #d32f2f; text-transform: uppercase; letter-spacing: 2px; }

        .leaflet-bottom.leaflet-left { margin-bottom: 20px; margin-left: 10px; }
        .popup-ficha { width: 220px; text-align: center; }
        .precio { color: #d32f2f; font-weight: 800; font-size: 17px; display: block; margin: 5px 0; }
        .grid-botones { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; margin-top: 8px; }
        .btn-act { padding: 8px; border-radius: 6px; text-decoration: none; color: white !important; font-size: 10px; font-weight: bold; text-align: center; border: none; }
    </style>
</head>
<body>

    <div class="header-ui">
        <div class="search-container">
            <span>üîç</span>
            <input type="text" id="buscador" class="search-bar" placeholder="Buscar inmueble..." onkeyup="filtrarMaestro()">
            <img src="https://acropolisinmo-dot.github.io/mapa-acropolis/logo.png" class="logo-top-right">
        </div>
        <div class="filters">
            <button class="btn-f active" onclick="cambiarUso('todos', this)">Todos</button>
            <button class="btn-f" onclick="cambiarUso('local', this)">Locales</button>
            <button class="btn-f" onclick="cambiarUso('bodega', this)">Bodegas</button>
        </div>
    </div>

    <div class="gps-wrapper">
        <svg class="circular-text" viewBox="0 0 100 100">
            <path id="circlePath" d="M 50, 50 m -37, 0 a 37,37 0 1,1 74,0 a 37,37 0 1,1 -74,0" fill="transparent"/>
            <text><textPath xlink:href="#circlePath">YO ESTOY AQU√ç ‚Ä¢ YO ESTOY AQU√ç ‚Ä¢ </textPath></text>
        </svg>
        <button class="gps-btn" onclick="buscarMiUbicacion()">üìç</button>
    </div>

    <div id="mi-mapa"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    <script>
        var map = L.map('mi-mapa', { zoomControl: true }).setView([10.98, -74.80], 12);
        map.zoomControl.setPosition('bottomleft');
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        var baseRuta = "https://acropolisinmo-dot.github.io/mapa-acropolis/";
        
        var locales = [
            { nombre: "Pueblito (Cra 12)", tipo: "local", precio: "1.700.000", area: "45 mt¬≤", coords: [10.963471, -74.839640], foto: "pueblito.jpg" },
            { nombre: "Pueblito (Local 3)", tipo: "local", precio: "1.000.000", area: "84 mt¬≤", coords: [10.963471, -74.839641], foto: "pueblito.jpg" },
            { nombre: "Universidad", tipo: "local", precio: "7.000.000", area: "110 mt¬≤", coords: [10.992707, -74.793603], foto: "universidad.jpg" },
            { 
                nombre: "Bodega 66", 
                tipo: "bodega", 
                precio: "10.000.000", 
                area: "710 mt¬≤", 
                coords: [10.996854, -74.796166], 
                esBodega: true, 
                carpeta: "Bodega 66", 
                prefijo: "bodega 66 foto ", 
                totalFotos: 6 
            },
            { nombre: "Trupillo", tipo: "local", precio: "2.500.000", area: "59 mt¬≤", coords: [10.9588, -74.7847], foto: "trupillo.jpg" },
            { nombre: "Juan de Acosta", tipo: "local", precio: "1.000.000", area: "30 mt¬≤", coords: [10.828794, -75.038221], foto: "juan.jpg" }
        ];

        var marcadoresCluster = L.markerClusterGroup();
        map.addLayer(marcadoresCluster);

        function filtrarMaestro() {
            marcadoresCluster.clearLayers();
            var busqueda = document.getElementById('buscador').value.toLowerCase();
            locales.forEach(function(l) {
                if (l.nombre.toLowerCase().includes(busqueda)) {
                    let media = "";
                    if (l.esBodega) {
                        let fotosSlider = "";
                        for(let i=1; i<=l.totalFotos; i++) {
                            // Construcci√≥n de ruta compatible con GitHub (maneja espacios y extensiones)
                            let urlBase = baseRuta + "fotos/" + encodeURIComponent(l.carpeta) + "/" + encodeURIComponent(l.prefijo + i);
                            fotosSlider += `
                                <img src="${urlBase}.jpg" 
                                     onerror="this.onerror=null; this.src='${urlBase}.JPG';" 
                                     style="width:100%; height:auto; max-height:120px; object-fit:contain; flex-shrink:0;">`;
                        }
                        media = `<div class="slider-container">${fotosSlider}</div><small style="color:#999; font-size:9px">‚Üî Desliza fotos</small>`;
                    } else {
                        media = `<img src="${baseRuta + l.foto}" class="img-local-chica" onerror="this.src='https://via.placeholder.com/220x80?text=Acropolis'">`;
                    }

                    var marker = L.marker(l.coords).bindPopup(`
                        <div class="popup-ficha">
                            ${media}
                            <h3 style="font-size:14px; margin:8px 0 4px 0">${l.nombre}</h3>
                            <span class="precio">$ ${l.precio}</span>
                            <span style="font-size:11px">üìè √Årea: ${l.area}</span>
                            <div class="grid-botones">
                                <a href="https://www.google.com/maps/dir/?api=1&destination=${l.coords[0]},${l.coords[1]}" target="_blank" class="btn-act" style="background:#4285F4">üìç Ruta</a>
                                <a href="https://wa.me/573243816458?text=Info sobre ${l.nombre}" target="_blank" class="btn-act" style="background:#25d366">üí¨ WA</a>
                                <button onclick="compartir('${l.nombre}', ${l.coords[0]}, ${l.coords[1]})" class="btn-act" style="background:#6c757d; grid-column: span 2;">üîó Compartir Propiedad</button>
                            </div>
                        </div>
                    `);
                    marcadoresCluster.addLayer(marker);
                }
            });
        }

        function compartir(n, lat, lng) {
            const t = `Inmueble: ${n}. Ver aqu√≠: https://www.google.com/maps?q=${lat},${lng}`;
            navigator.clipboard.writeText(t).then(() => alert("Copiado al portapapeles"));
        }

        function buscarMiUbicacion() { map.locate({setView: true, maxZoom: 16}); }
        map.on('locationfound', function(e) {
            L.circle(e.latlng, {radius: 50, color: '#d32f2f'}).addTo(map);
            L.marker(e.latlng).addTo(map).bindPopup("Est√°s aqu√≠").openPopup();
        });

        window.onload = function() { filtrarMaestro(); };
    </script>
</body>
</html>
