<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Acropolis Realty - Marketplace</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-geosearch@3.11.0/dist/geosearch.css" />

    <style>
        html, body { height: 100%; width: 100%; margin: 0; padding: 0; font-family: 'Segoe UI', Roboto, sans-serif; overflow: hidden; }
        #mi-mapa { height: 100%; width: 100%; z-index: 1; }

        /* 1. BARRA DE B√öSQUEDA Y FILTROS */
        .top-container {
            position: absolute; top: 10px; left: 10px; right: 10px; z-index: 1000;
            display: flex; flex-direction: column; gap: 8px; pointer-events: none;
        }
        .search-box, .filter-row { pointer-events: auto; }
        
        .search-box input {
            width: 100%; padding: 12px; border-radius: 25px; border: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2); font-size: 14px; outline: none;
        }

        .filter-row { display: flex; gap: 5px; overflow-x: auto; padding-bottom: 5px; }
        .btn-f {
            background: white; border: none; padding: 8px 15px; border-radius: 20px;
            white-space: nowrap; font-size: 12px; font-weight: 600; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .btn-f.active { background: #d32f2f; color: white; }

        /* 2. BOT√ìN MI UBICACI√ìN */
        .gps-btn {
            position: absolute; bottom: 120px; right: 15px; z-index: 1000;
            background: white; width: 45px; height: 45px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3); font-size: 20px; cursor: pointer;
        }

        /* 3. POPUP PROFESIONAL */
        .popup-ficha { width: 240px; }
        .badge { 
            position: absolute; top: 10px; right: 10px; padding: 3px 8px; 
            border-radius: 5px; font-size: 10px; color: white; font-weight: bold;
        }
        .gold { background: linear-gradient(45deg, #ffd700, #ff8c00); }
        .standard { background: #2196F3; }
        
        .img-container { position: relative; width: 100%; height: 140px; border-radius: 10px; overflow: hidden; }
        .img-container img { width: 100%; height: 100%; object-fit: cover; }
        
        .info-header { margin-top: 10px; }
        .broker-tag { font-size: 10px; color: #888; text-transform: uppercase; letter-spacing: 1px; }
        .price { color: #d32f2f; font-size: 18px; font-weight: 800; margin: 2px 0; }
        
        .actions { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; margin-top: 10px; }
        .btn-act {
            padding: 10px; border-radius: 8px; text-decoration: none; text-align: center;
            font-size: 12px; font-weight: bold; color: white !important;
        }
    </style>
</head>
<body>

    <div class="top-container">
        <div class="search-box">
            <input type="text" id="busqueda" placeholder="Buscar barrio, nombre o broker..." onkeyup="buscar()">
        </div>
        <div class="filter-row">
            <button class="btn-f active" onclick="filtrar('todos', this)">Todos</button>
            <button class="btn-f" onclick="filtrar('local', this)">Locales</button>
            <button class="btn-f" onclick="filtrar('bodega', this)">Bodegas</button>
            <button class="btn-f" onclick="filtrar('premium', this)">‚ú® Premium</button>
        </div>
    </div>

    <div class="gps-btn" onclick="miUbicacion()">üìç</div>

    <div id="mi-mapa"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        var map = L.map('mi-mapa', { zoomControl: false }).setView([10.9750, -74.8100], 13);
        L.control.zoom({ position: 'bottomright' }).addTo(map);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        var baseRuta = "https://acropolisinmo-dot.github.io/mapa-acropolis/";
        
        // 10. Datos preparados para brokers externos
        var locales = [
            { id: 1, nombre: "Trupillo", tipo: "local", cat: "premium", precio: "2.500.000", coords: [10.9588, -74.7846], foto: "trupillo.jpg", broker: "Acropolis", wa: "573243816458" },
            { id: 2, nombre: "Bodega Prado", tipo: "bodega", cat: "standard", precio: "4.500.000", coords: [10.9968, -74.7961], foto: "bodega.jpg", broker: "Broker Externo", wa: "573000000000" },
            { id: 3, nombre: "Local Universidad", tipo: "local", cat: "standard", precio: "1.800.000", coords: [10.9927, -74.7936], foto: "universidad.jpg", broker: "Inmuebles Ya", wa: "573110000000" }
        ];

        var capaMarcadores = L.layerGroup().addTo(map);
        var fUso = 'todos';

        function dibujar(data = locales) {
            capaMarcadores.clearLayers();
            data.forEach(function(l) {
                if (fUso === 'todos' || l.tipo === fUso || l.cat === fUso) {
                    // 5. Personalizaci√≥n de PIN por categor√≠a
                    var color = l.cat === 'premium' ? 'orange' : 'blue';
                    var icon = L.icon({
                        iconUrl: `https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-${color}.png`,
                        iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34]
                    });

                    var marker = L.marker(l.coords, {icon: icon}).addTo(capaMarcadores);
                    
                    // 3, 7 & 9. Ficha con botones din√°micos
                    marker.bindPopup(`
                        <div class="popup-ficha">
                            <div class="img-container">
                                <div class="badge ${l.cat === 'premium' ? 'gold' : 'standard'}">${l.cat}</div>
                                <img src="${baseRuta + l.foto}" onerror="this.src='https://via.placeholder.com/200x140'">
                            </div>
                            <div class="info-header">
                                <div class="broker-tag">Publicado por: ${l.broker}</div>
                                <h3 style="margin:2px 0">${l.nombre}</h3>
                                <div class="price">$ ${l.precio}</div>
                            </div>
                            <div class="actions">
                                <a href="https://www.google.com/maps/dir/?api=1&destination=${l.coords[0]},${l.coords[1]}" target="_blank" class="btn-act" style="background:#4285F4">üìç Ruta</a>
